#!/bin/bash
#if [[ -z $DISPLAY ]];then
#    mpc pause 2>/dev/null
#    /usr/bin/mplayer -vo fbdev  "$@"
#    exit
#fi
HIST="$HOME/.mplayer.hist"
$LOCK/mplayer /usr/bin/mplayer -slave -idle -input file=$MPSOCKET &>/dev/null  & 

if [[ -z "$1" ]];then
      num=$(awk '{ print NR":"$0 }' $HIST | tac | $DMENU | cut -d ":" -f 1)
      if [[ -z "$num" ]];then
        FILE=`tail -1 $HIST`
      else
        FILE=$(head -${num} $HIST | tail -1)
      fi
else
	prefix="`pwd`/"
    if [[ "$@" =~ ^/.* ]];then prefix=;fi
	FILE="${prefix}$@"
fi

echo "$FILE" >> $HOME/.mplayer.hist
mpc pause &>/dev/null
echo "loadfile \"$FILE\"" > $MPSOCKET
